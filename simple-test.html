<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–®é€£ç·šæ¸¬è©¦</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .result {
            background: white;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #F44336; }
        .info { border-left: 4px solid #2196F3; }
        pre { background: #f9f9f9; padding: 1rem; border-radius: 4px; font-size: 0.9rem; }
        button { 
            background: #4CAF50; 
            color: white; 
            border: none; 
            padding: 0.8rem 1.5rem; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>ğŸ” ç°¡å–®è³‡æ–™åº«é€£ç·šæ¸¬è©¦</h1>
    
    <div id="status">
        <div class="result info">
            <strong>æ­£åœ¨åˆå§‹åŒ–...</strong>
        </div>
    </div>

    <button onclick="runTest()">åŸ·è¡Œæ¸¬è©¦</button>
    <button onclick="clearStatus()">æ¸…é™¤</button>

    <script>
        function log(type, title, content = '') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            let html = `<strong>${title}</strong>`;
            if (content) {
                html += typeof content === 'object' ? 
                    `<pre>${JSON.stringify(content, null, 2)}</pre>` : 
                    `<br/>${content}`;
            }
            div.innerHTML = html;
            document.getElementById('status').appendChild(div);
        }

        function clearStatus() {
            document.getElementById('status').innerHTML = '';
        }

        async function runTest() {
            clearStatus();
            
            // æ­¥é©Ÿ 1: æª¢æŸ¥ Supabase è¼‰å…¥
            log('info', 'æ­¥é©Ÿ 1: æª¢æŸ¥ Supabase æ˜¯å¦è¼‰å…¥...');
            
            if (typeof window.supabase === 'undefined') {
                log('error', 'âŒ Supabase CDN æœªè¼‰å…¥', 'è«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
                return;
            }
            log('success', 'âœ… Supabase CDN å·²è¼‰å…¥');

            // æ­¥é©Ÿ 2: åˆå§‹åŒ–å®¢æˆ¶ç«¯
            log('info', 'æ­¥é©Ÿ 2: åˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯...');
            
            const supabaseUrl = 'https://oytgyizrtuqyxvxtgrlv.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95dGd5aXpydHVxeXh2eHRncmx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1NzUwNjgsImV4cCI6MjA3MTE1MTA2OH0.OiHI8KP-p0OOKo6XvPOARsz0pYqWBEMowJbL0wOzrQs';
            
            let supabaseClient;
            try {
                supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
                log('success', 'âœ… Supabase å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ', {
                    url: supabaseUrl,
                    keyLength: supabaseKey.length
                });
            } catch (error) {
                log('error', 'âŒ å®¢æˆ¶ç«¯åˆå§‹åŒ–å¤±æ•—', error.message);
                return;
            }

            // æ­¥é©Ÿ 3: æ¸¬è©¦åŸºæœ¬é€£ç·š
            log('info', 'æ­¥é©Ÿ 3: æ¸¬è©¦è³‡æ–™åº«é€£ç·š...');
            
            try {
                const { data, error } = await supabaseClient
                    .from('lost_items')
                    .select('count', { count: 'exact', head: true });

                if (error) {
                    log('error', 'âŒ è³‡æ–™åº«é€£ç·šå¤±æ•—', {
                        error: error.message,
                        details: error.details,
                        hint: error.hint
                    });
                } else {
                    log('success', 'âœ… è³‡æ–™åº«é€£ç·šæˆåŠŸï¼', `lost_items è¡¨å¯ä»¥æ­£å¸¸è¨ªå•`);
                }
            } catch (err) {
                log('error', 'âŒ é€£ç·šæ¸¬è©¦ç•°å¸¸', err.message);
            }

            // æ­¥é©Ÿ 4: æª¢æŸ¥è¡¨çµæ§‹
            log('info', 'æ­¥é©Ÿ 4: æª¢æŸ¥è¡¨çµæ§‹...');
            
            try {
                const { data, error } = await supabaseClient
                    .from('lost_items')
                    .select('*')
                    .limit(5);

                if (error) {
                    log('error', 'âŒ ç„¡æ³•è®€å–è¡¨è³‡æ–™', error.message);
                } else {
                    log('success', 'âœ… è¡¨çµæ§‹æ­£å¸¸', {
                        recordCount: data.length,
                        sampleData: data.length > 0 ? data[0] : 'ç„¡è³‡æ–™'
                    });
                }
            } catch (err) {
                log('error', 'âŒ è¡¨çµæ§‹æª¢æŸ¥ç•°å¸¸', err.message);
            }

            // æ­¥é©Ÿ 5: æª¢æŸ¥å·²æ­¸é‚„è¡¨
            log('info', 'æ­¥é©Ÿ 5: æª¢æŸ¥ returned_items è¡¨...');
            
            try {
                const { data, error } = await supabaseClient
                    .from('returned_items')
                    .select('count', { count: 'exact', head: true });

                if (error) {
                    log('error', 'âŒ returned_items è¡¨ä¸å­˜åœ¨æˆ–ç„¡æ¬Šé™', error.message);
                } else {
                    log('success', 'âœ… returned_items è¡¨æ­£å¸¸');
                }
            } catch (err) {
                log('error', 'âŒ returned_items æª¢æŸ¥ç•°å¸¸', err.message);
            }

            log('info', 'ğŸ‰ æ¸¬è©¦å®Œæˆï¼');
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œ
        window.addEventListener('load', function() {
            setTimeout(runTest, 500);
        });
    </script>
</body>
</html>
