<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡æ–™åº«é€£ç·šæ¸¬è©¦</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 5px;
            border-left: 4px solid #ccc;
        }
        .success { border-left-color: #4CAF50; background: #E8F5E8; }
        .error { border-left-color: #F44336; background: #FFEBEE; }
        .info { border-left-color: #2196F3; background: #E3F2FD; }
        .warning { border-left-color: #FF9800; background: #FFF3E0; }
        pre { background: #f9f9f9; padding: 1rem; border-radius: 5px; overflow-x: auto; }
        button { 
            background: #4CAF50; 
            color: white; 
            border: none; 
            padding: 0.8rem 1.5rem; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 0.5rem;
        }
        button:hover { background: #45a049; }
        .btn-secondary { background: #2196F3; }
        .btn-secondary:hover { background: #1976D2; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ” Supabase è³‡æ–™åº«é€£ç·šæ¸¬è©¦</h1>
        
        <div id="results"></div>
        
        <div style="margin-top: 2rem;">
            <button onclick="testConnection()">æ¸¬è©¦é€£ç·š</button>
            <button onclick="testTables()" class="btn-secondary">æª¢æŸ¥è³‡æ–™è¡¨</button>
            <button onclick="testInsert()" class="btn-secondary">æ¸¬è©¦æ–°å¢è³‡æ–™</button>
            <button onclick="clearResults()">æ¸…é™¤çµæœ</button>
        </div>
    </div>

    <script>
        let supabase;
        
        // ç›´æ¥ä½¿ç”¨é…ç½®è³‡æ–™
        const SUPABASE_CONFIG = {
            url: 'https://oytgyizrtuqyxvxtgrlv.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95dGd5aXpydHVxeXh2eHRncmx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1NzUwNjgsImV4cCI6MjA3MTE1MTA2OH0.OiHI8KP-p0OOKo6XvPOARsz0pYqWBEMowJbL0wOzrQs'
        };
        
        // åˆå§‹åŒ– Supabase
        try {
            supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
            addResult('info', 'âœ… Supabase å®¢æˆ¶ç«¯å·²åˆå§‹åŒ–', {
                url: SUPABASE_CONFIG.url,
                keyPrefix: SUPABASE_CONFIG.anonKey.substring(0, 20) + '...'
            });
        } catch (error) {
            addResult('error', 'âŒ Supabase åˆå§‹åŒ–å¤±æ•—', error.message);
        }

        function addResult(type, title, content = '') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-item ${type}`;
            
            let html = `<strong>${title}</strong>`;
            if (content) {
                if (typeof content === 'object') {
                    html += `<pre>${JSON.stringify(content, null, 2)}</pre>`;
                } else {
                    html += `<br>${content}`;
                }
            }
            
            div.innerHTML = html;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        async function testConnection() {
            addResult('info', 'ğŸ” é–‹å§‹æ¸¬è©¦è³‡æ–™åº«é€£ç·š...');
            
            try {
                // æ¸¬è©¦åŸºæœ¬é€£ç·š
                const { data, error } = await supabase
                    .from('lost_items')
                    .select('count', { count: 'exact', head: true });

                if (error) {
                    addResult('error', 'âŒ é€£ç·šå¤±æ•—', error.message);
                } else {
                    addResult('success', 'âœ… è³‡æ–™åº«é€£ç·šæˆåŠŸï¼', `lost_items è¡¨å­˜åœ¨ï¼Œå…±æœ‰ ${data?.length || 0} ç­†è¨˜éŒ„`);
                }
            } catch (err) {
                addResult('error', 'âŒ é€£ç·šæ¸¬è©¦ç™¼ç”ŸéŒ¯èª¤', err.message);
            }
        }

        async function testTables() {
            addResult('info', 'ğŸ” æª¢æŸ¥è³‡æ–™è¡¨çµæ§‹...');
            
            try {
                // æª¢æŸ¥ lost_items è¡¨
                const { data: lostItems, error: lostError } = await supabase
                    .from('lost_items')
                    .select('*')
                    .limit(1);

                if (lostError) {
                    addResult('error', 'âŒ lost_items è¡¨æŸ¥è©¢å¤±æ•—', lostError.message);
                } else {
                    addResult('success', 'âœ… lost_items è¡¨æ­£å¸¸', `è¡¨çµæ§‹ï¼š${lostItems.length > 0 ? Object.keys(lostItems[0]).join(', ') : 'ç„¡è³‡æ–™ï¼Œä½†è¡¨å­˜åœ¨'}`);
                }

                // æª¢æŸ¥ returned_items è¡¨
                const { data: returnedItems, error: returnedError } = await supabase
                    .from('returned_items')
                    .select('*')
                    .limit(1);

                if (returnedError) {
                    addResult('warning', 'âš ï¸ returned_items è¡¨å¯èƒ½ä¸å­˜åœ¨', returnedError.message);
                } else {
                    addResult('success', 'âœ… returned_items è¡¨æ­£å¸¸', `è¡¨çµæ§‹ï¼š${returnedItems.length > 0 ? Object.keys(returnedItems[0]).join(', ') : 'ç„¡è³‡æ–™ï¼Œä½†è¡¨å­˜åœ¨'}`);
                }

            } catch (err) {
                addResult('error', 'âŒ è¡¨çµæ§‹æª¢æŸ¥ç™¼ç”ŸéŒ¯èª¤', err.message);
            }
        }

        async function testInsert() {
            addResult('info', 'ğŸ” æ¸¬è©¦æ–°å¢è³‡æ–™...');
            
            try {
                const testData = {
                    name: 'æ¸¬è©¦ç‰©å“',
                    description: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦ç‰©å“',
                    found_location: 'æ¸¬è©¦åœ°é»',
                    story: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦æ•…äº‹',
                    finder_name: 'æ¸¬è©¦è€…',
                    found_time: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('lost_items')
                    .insert([testData])
                    .select();

                if (error) {
                    addResult('error', 'âŒ æ–°å¢è³‡æ–™å¤±æ•—', error.message);
                } else {
                    addResult('success', 'âœ… æ–°å¢è³‡æ–™æˆåŠŸï¼', data);
                    
                    // ç«‹å³åˆªé™¤æ¸¬è©¦è³‡æ–™
                    const { error: deleteError } = await supabase
                        .from('lost_items')
                        .delete()
                        .eq('id', data[0].id);
                    
                    if (deleteError) {
                        addResult('warning', 'âš ï¸ æ¸…ç†æ¸¬è©¦è³‡æ–™å¤±æ•—', deleteError.message);
                    } else {
                        addResult('info', 'ğŸ§¹ æ¸¬è©¦è³‡æ–™å·²æ¸…ç†');
                    }
                }
            } catch (err) {
                addResult('error', 'âŒ æ–°å¢æ¸¬è©¦ç™¼ç”ŸéŒ¯èª¤', err.message);
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            if (supabase) {
                addResult('info', 'âœ… Supabase å®¢æˆ¶ç«¯å·²åˆå§‹åŒ–', {
                    url: SUPABASE_CONFIG.url,
                    keyPrefix: SUPABASE_CONFIG.anonKey.substring(0, 20) + '...'
                });
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦é€£ç·š
        window.addEventListener('load', function() {
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>
