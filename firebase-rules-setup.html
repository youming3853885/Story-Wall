<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase è¦å‰‡è¨­å®šåŠ©æ‰‹</title>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: #333;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #4285f4;
            margin: 0;
        }
        .step {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4285f4;
        }
        .step h3 {
            margin-top: 0;
            color: #4285f4;
        }
        .code-block {
            background: #f1f3f4;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4285f4;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .copy-btn:hover {
            background: #3367d6;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
        }
        .btn.success {
            background: #34a853;
        }
        .btn.success:hover {
            background: #2d8f47;
        }
        .checklist {
            list-style: none;
            padding: 0;
        }
        .checklist li {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #ddd;
        }
        .checklist li.completed {
            border-left-color: #34a853;
            background: #e8f5e8;
        }
        .checklist li input[type="checkbox"] {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ Firebase è¦å‰‡è¨­å®šåŠ©æ‰‹</h1>
            <p>ä¸€æ­¥æ­¥è¨­å®š Firebase Firestore å’Œ Storage å®‰å…¨è¦å‰‡</p>
        </div>

        <div class="step">
            <h3>ğŸ“‹ è¨­å®šæª¢æŸ¥æ¸…å–®</h3>
            <ul class="checklist">
                <li>
                    <input type="checkbox" id="check1" onchange="updateProgress()">
                    <label for="check1">å·²å»ºç«‹ Firebase å°ˆæ¡ˆ</label>
                </li>
                <li>
                    <input type="checkbox" id="check2" onchange="updateProgress()">
                    <label for="check2">å·²å•Ÿç”¨ Firestore Database</label>
                </li>
                <li>
                    <input type="checkbox" id="check3" onchange="updateProgress()">
                    <label for="check3">å·²å•Ÿç”¨ Firebase Storage</label>
                </li>
                <li>
                    <input type="checkbox" id="check4" onchange="updateProgress()">
                    <label for="check4">å·²è¨­å®š Firestore è¦å‰‡</label>
                </li>
                <li>
                    <input type="checkbox" id="check5" onchange="updateProgress()">
                    <label for="check5">å·²è¨­å®š Storage è¦å‰‡</label>
                </li>
                <li>
                    <input type="checkbox" id="check6" onchange="updateProgress()">
                    <label for="check6">å·²æ¸¬è©¦è¦å‰‡æ˜¯å¦ç”Ÿæ•ˆ</label>
                </li>
            </ul>
        </div>

        <div class="step">
            <h3>ğŸ—„ï¸ æ­¥é©Ÿ 1ï¼šè¨­å®š Firestore Database è¦å‰‡</h3>
            <div class="info">
                <p><strong>æ“ä½œæ­¥é©Ÿï¼š</strong></p>
                <ol>
                    <li>å‰å¾€ <a href="https://console.firebase.google.com/" target="_blank">Firebase æ§åˆ¶å°</a></li>
                    <li>é¸æ“‡æ‚¨çš„å°ˆæ¡ˆï¼š<strong>story-wall-7af82</strong></li>
                    <li>å·¦å´é¸å–® â†’ <strong>Firestore Database</strong></li>
                    <li>é»æ“Šé ‚éƒ¨çš„ <strong>è¦å‰‡</strong> æ¨™ç±¤</li>
                    <li>å°‡ä¸‹æ–¹è¦å‰‡è¤‡è£½ä¸¦è²¼ä¸Šï¼Œæ›¿æ›ç¾æœ‰å…§å®¹</li>
                    <li>é»æ“Š <strong>ç™¼å¸ƒ</strong></li>
                </ol>
            </div>
            
            <div class="code-block">
                <button class="copy-btn" onclick="copyToClipboard('firestoreRules')">è¤‡è£½</button>
                <pre id="firestoreRules">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // å…è¨±è®€å–å’Œå¯«å…¥å¤±ç‰©è³‡æ–™
    match /lost_items/{document} {
      allow read, write: if true;
    }
    
    // å…è¨±è®€å–å’Œå¯«å…¥å·²æ­¸é‚„è³‡æ–™
    match /returned_items/{document} {
      allow read, write: if true;
    }
    
    // æ¸¬è©¦ç”¨é›†åˆï¼ˆå¯é¸ï¼‰
    match /test/{document} {
      allow read, write: if true;
    }
  }
}</pre>
            </div>
            
            <div class="warning">
                <p><strong>âš ï¸ å®‰å…¨æé†’ï¼š</strong>é€™äº›è¦å‰‡å…è¨±æ‰€æœ‰äººè®€å¯«è³‡æ–™ï¼Œé©åˆæ¸¬è©¦ä½¿ç”¨ã€‚æ­£å¼ç’°å¢ƒå»ºè­°åŠ å…¥é©ç•¶çš„é©—è­‰æ©Ÿåˆ¶ã€‚</p>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ“ æ­¥é©Ÿ 2ï¼šè¨­å®š Firebase Storage è¦å‰‡</h3>
            <div class="info">
                <p><strong>æ“ä½œæ­¥é©Ÿï¼š</strong></p>
                <ol>
                    <li>åœ¨ Firebase æ§åˆ¶å°ä¸­</li>
                    <li>å·¦å´é¸å–® â†’ <strong>Storage</strong></li>
                    <li>å¦‚æœé‚„æ²’å•Ÿç”¨ï¼Œé»æ“Š <strong>é–‹å§‹ä½¿ç”¨</strong></li>
                    <li>é¸æ“‡ <strong>ä»¥æ¸¬è©¦æ¨¡å¼é–‹å§‹</strong></li>
                    <li>é¸æ“‡åœ°å€ï¼ˆå»ºè­°ï¼š<strong>asia-east1</strong> å°ç£ï¼‰</li>
                    <li>é»æ“Šé ‚éƒ¨çš„ <strong>è¦å‰‡</strong> æ¨™ç±¤</li>
                    <li>å°‡ä¸‹æ–¹è¦å‰‡è¤‡è£½ä¸¦è²¼ä¸Šï¼Œæ›¿æ›ç¾æœ‰å…§å®¹</li>
                    <li>é»æ“Š <strong>ç™¼å¸ƒ</strong></li>
                </ol>
            </div>
            
            <div class="code-block">
                <button class="copy-btn" onclick="copyToClipboard('storageRules')">è¤‡è£½</button>
                <pre id="storageRules">rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // å…è¨±è®€å–å’Œä¸Šå‚³å¤±ç‰©åœ–ç‰‡
    match /lost-items-images/{allPaths=**} {
      allow read, write: if true;
    }
    
    // æ¸¬è©¦ç”¨è³‡æ–™å¤¾ï¼ˆå¯é¸ï¼‰
    match /test/{allPaths=**} {
      allow read, write: if true;
    }
  }
}</pre>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ§ª æ­¥é©Ÿ 3ï¼šæ¸¬è©¦è¦å‰‡è¨­å®š</h3>
            <p>è¨­å®šå®Œæˆå¾Œï¼Œè«‹æ¸¬è©¦è¦å‰‡æ˜¯å¦æ­£ç¢ºç”Ÿæ•ˆï¼š</p>
            
            <button class="btn" onclick="testFirebaseRules()">æ¸¬è©¦ Firebase è¦å‰‡</button>
            <button class="btn success" onclick="window.open('firebase-test.html', '_blank')">é–‹å•Ÿ Firebase æ¸¬è©¦é é¢</button>
            
            <div id="testResults" style="margin-top: 20px;"></div>
        </div>

        <div class="step">
            <h3>ğŸš€ æ­¥é©Ÿ 4ï¼šé–‹å§‹ä½¿ç”¨ Firebase</h3>
            <div class="success">
                <p><strong>âœ… æ­å–œï¼</strong>Firebase è¨­å®šå®Œæˆå¾Œï¼Œæ‚¨å¯ä»¥ï¼š</p>
                <ul>
                    <li>ç›´æ¥ä½¿ç”¨ Firebase ç‰ˆæœ¬çš„å¤±ç‰©æ•…äº‹ç‰†</li>
                    <li>ä¸Šå‚³æ–°çš„å¤±ç‰©è³‡æ–™</li>
                    <li>äº«å—æ›´å¿«é€Ÿã€æ›´ç©©å®šçš„æœå‹™</li>
                    <li>ä¸ç”¨æ“”å¿ƒ Supabase çš„é€£æ¥å•é¡Œ</li>
                </ul>
            </div>
            
            <div class="info">
                <p><strong>ğŸ’¡ å»ºè­°ï¼š</strong>å³ä½¿æ²’æœ‰å¾ Supabase é·ç§»è³‡æ–™ï¼Œæ‚¨ä¹Ÿå¯ä»¥ç›´æ¥é–‹å§‹ä½¿ç”¨ Firebaseã€‚é‡è¦çš„å¤±ç‰©è³‡æ–™å¯ä»¥é‡æ–°è¼¸å…¥ï¼Œè€Œä¸” Firebase æä¾›æ›´å¥½çš„é•·æœŸç©©å®šæ€§ã€‚</p>
            </div>
            
            <a href="firebase-test.html" class="btn success">ğŸ‰ é–‹å§‹ä½¿ç”¨ Firebase ç‰ˆæœ¬</a>
        </div>

        <div class="step">
            <h3>ğŸ“ éœ€è¦å¹«åŠ©ï¼Ÿ</h3>
            <div class="info">
                <p>å¦‚æœåœ¨è¨­å®šéç¨‹ä¸­é‡åˆ°å•é¡Œï¼š</p>
                <ul>
                    <li>æª¢æŸ¥ Firebase æ§åˆ¶å°æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯</li>
                    <li>ç¢ºèªå°ˆæ¡ˆ ID æ˜¯å¦æ­£ç¢ºï¼š<strong>story-wall-7af82</strong></li>
                    <li>å˜—è©¦é‡æ–°æ•´ç†ç€è¦½å™¨</li>
                    <li>æª¢æŸ¥ç¶²è·¯é€£ç·šæ˜¯å¦ç©©å®š</li>
                </ul>
            </div>
            
            <button class="btn" onclick="window.open('supabase-diagnosis.html', '_blank')">ğŸ” Supabase è¨ºæ–·å·¥å…·</button>
        </div>
    </div>

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <script>
        // Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyDm1Arp6DTUerSdTKjC4T4ndMRNDog4fuI",
            authDomain: "story-wall-7af82.firebaseapp.com",
            projectId: "story-wall-7af82",
            storageBucket: "story-wall-7af82.firebasestorage.app",
            messagingSenderId: "308812034466",
            appId: "1:308812034466:web:afa66ee199a49a5f49c2fb",
            measurementId: "G-QSEJ431VV0"
        };

        let firebaseApp, db, storage;

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = element.parentElement.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = 'å·²è¤‡è£½ï¼';
                btn.style.background = '#34a853';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#4285f4';
                }, 2000);
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½');
            });
        }

        function updateProgress() {
            const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
            checkboxes.forEach((checkbox, index) => {
                const li = checkbox.parentElement;
                if (checkbox.checked) {
                    li.classList.add('completed');
                } else {
                    li.classList.remove('completed');
                }
            });
        }

        async function testFirebaseRules() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>ğŸ§ª æ­£åœ¨æ¸¬è©¦ Firebase è¦å‰‡...</p>';
            
            try {
                // åˆå§‹åŒ– Firebase
                if (!firebaseApp) {
                    firebaseApp = firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    storage = firebase.storage();
                }
                
                let results = [];
                
                // æ¸¬è©¦ Firestore å¯«å…¥æ¬Šé™
                try {
                    await db.collection('test').doc('rules-test').set({
                        message: 'Firebase è¦å‰‡æ¸¬è©¦',
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    results.push('âœ… Firestore å¯«å…¥æ¬Šé™æ­£å¸¸');
                } catch (error) {
                    results.push(`âŒ Firestore å¯«å…¥å¤±æ•—: ${error.message}`);
                }
                
                // æ¸¬è©¦ Firestore è®€å–æ¬Šé™
                try {
                    const doc = await db.collection('test').doc('rules-test').get();
                    if (doc.exists) {
                        results.push('âœ… Firestore è®€å–æ¬Šé™æ­£å¸¸');
                    } else {
                        results.push('âš ï¸ Firestore è®€å–æ¬Šé™å¯èƒ½æœ‰å•é¡Œ');
                    }
                } catch (error) {
                    results.push(`âŒ Firestore è®€å–å¤±æ•—: ${error.message}`);
                }
                
                // æ¸¬è©¦ Storage ä¸Šå‚³æ¬Šé™
                try {
                    const testRef = storage.ref('test/rules-test.txt');
                    await testRef.putString('Firebase Storage è¦å‰‡æ¸¬è©¦');
                    results.push('âœ… Storage ä¸Šå‚³æ¬Šé™æ­£å¸¸');
                    
                    // æ¸…ç†æ¸¬è©¦æª”æ¡ˆ
                    await testRef.delete();
                } catch (error) {
                    results.push(`âŒ Storage ä¸Šå‚³å¤±æ•—: ${error.message}`);
                }
                
                // æ¸…ç†æ¸¬è©¦è³‡æ–™
                try {
                    await db.collection('test').doc('rules-test').delete();
                } catch (error) {
                    // å¿½ç•¥æ¸…ç†éŒ¯èª¤
                }
                
                // é¡¯ç¤ºçµæœ
                const resultClass = results.every(r => r.startsWith('âœ…')) ? 'success' : 'warning';
                resultsDiv.innerHTML = `
                    <div class="${resultClass}">
                        <h4>æ¸¬è©¦çµæœï¼š</h4>
                        <ul>
                            ${results.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>
                `;
                
                if (resultClass === 'success') {
                    resultsDiv.innerHTML += `
                        <div class="success">
                            <p><strong>ğŸ‰ å¤ªæ£’äº†ï¼</strong>æ‰€æœ‰ Firebase è¦å‰‡éƒ½è¨­å®šæ­£ç¢ºï¼Œæ‚¨å¯ä»¥é–‹å§‹ä½¿ç”¨äº†ï¼</p>
                            <a href="firebase-test.html" class="btn success">ç«‹å³é–‹å§‹ä½¿ç”¨</a>
                        </div>
                    `;
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="warning">
                        <p><strong>âŒ æ¸¬è©¦å¤±æ•—ï¼š</strong>${error.message}</p>
                        <p>è«‹æª¢æŸ¥ Firebase è¦å‰‡æ˜¯å¦æ­£ç¢ºè¨­å®šï¼Œä¸¦ç¢ºèªå°ˆæ¡ˆé…ç½®ç„¡èª¤ã€‚</p>
                    </div>
                `;
            }
        }

        // é é¢è¼‰å…¥æ™‚çš„æç¤º
        window.addEventListener('load', () => {
            console.log('ğŸ”§ Firebase è¦å‰‡è¨­å®šåŠ©æ‰‹å·²è¼‰å…¥');
        });
    </script>
</body>
</html>
