<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡åŒ–æ‰¾åˆ°ä¸»äººæ¸¬è©¦</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 2rem;
            margin: 1rem 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #F44336; }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        button:hover { background: #45a049; }
        
        .console-output {
            background: #000;
            color: #0f0;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ç°¡åŒ–æ‰¾åˆ°ä¸»äººæ¸¬è©¦</h1>
    
    <div class="test-section">
        <h3>ğŸ¯ æ¸¬è©¦ç›®æ¨™</h3>
        <p>æ¸¬è©¦æ‰¾åˆ°ä¸»äººåŠŸèƒ½çš„æ¯å€‹æ­¥é©Ÿï¼Œä¸¦è¿½è¹¤å¯èƒ½çš„éŒ¯èª¤ï¼š</p>
        
        <button onclick="step1_TestShowModal()">æ­¥é©Ÿ1: æ¸¬è©¦é¡¯ç¤ºå½ˆçª—</button>
        <button onclick="step2_TestConfirmName()">æ­¥é©Ÿ2: æ¸¬è©¦ç¢ºèªå§“å</button>
        <button onclick="step3_TestShowConfirm()">æ­¥é©Ÿ3: æ¸¬è©¦é¡¯ç¤ºç¢ºèª</button>
        <button onclick="clearConsole()">æ¸…é™¤è¼¸å‡º</button>
    </div>

    <div class="test-section">
        <h3>ğŸ“ Console è¼¸å‡º</h3>
        <div id="consoleOutput" class="console-output">ç­‰å¾…æ¸¬è©¦...\n</div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„ HTML çµæ§‹ -->
    <div class="owner-input-modal" id="ownerInputModal">
        <div class="owner-input-content">
            <div class="owner-input-header">
                <h3>ğŸ‰ æ‰¾åˆ°ä¸»äººäº†ï¼</h3>
                <button class="close-btn" onclick="hideOwnerInputModal()">âœ•</button>
            </div>
            <div class="owner-input-body">
                <div class="found-item-preview" id="foundItemPreview"></div>
                <div class="owner-name-section">
                    <label for="ownerNameInput">è«‹è¼¸å…¥ç‰©å“ä¸»äººå§“åï¼š</label>
                    <input type="text" id="ownerNameInput" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜" maxlength="50">
                </div>
            </div>
            <div class="owner-input-actions">
                <button onclick="confirmOwnerName()" class="owner-btn primary" id="confirmOwnerBtn">
                    âœ… ç¢ºèªå§“å
                </button>
                <button onclick="hideOwnerInputModal()" class="owner-btn secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div class="owner-confirm-modal" id="ownerConfirmModal">
        <div class="owner-confirm-content">
            <div class="owner-confirm-header">
                <h3>ğŸ” è«‹ç¢ºèªè³‡è¨Š</h3>
            </div>
            <div class="owner-confirm-body">
                <div class="confirm-info" id="confirmInfo"></div>
            </div>
            <div class="owner-confirm-actions">
                <button onclick="testFinalConfirm()" class="owner-btn primary confirm">
                    ğŸ‰ æ¸¬è©¦ç¢ºèª
                </button>
                <button onclick="hideOwnerConfirmModal()" class="owner-btn secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="script.js"></script>
    <script>
        let testOutput = '';
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            testOutput += `[${timestamp}] ${message}\n`;
            document.getElementById('consoleOutput').textContent = testOutput;
            console.log(message);
        }
        
        function clearConsole() {
            testOutput = '';
            document.getElementById('consoleOutput').textContent = 'ç­‰å¾…æ¸¬è©¦...\n';
        }

        // æ­¥é©Ÿ1: æ¸¬è©¦é¡¯ç¤ºå½ˆçª—
        function step1_TestShowModal() {
            log('ğŸš€ æ­¥é©Ÿ1: æ¸¬è©¦é¡¯ç¤ºå½ˆçª—');
            
            // æ¨¡æ“¬å¤±ç‰©è³‡æ–™
            window.currentFoundItem = {
                id: 999,
                name: 'æ¸¬è©¦æ°´å£º',
                found_location: 'æ¸¬è©¦åœ°é»',
                found_time: new Date().toISOString(),
                image_url: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"%3E%3Crect width="200" height="200" fill="%23F0F0F0"/%3E%3Ctext x="100" y="100" text-anchor="middle" font-family="Arial" font-size="16" fill="%23999"%3Eæ¸¬è©¦åœ–ç‰‡%3C/text%3E%3C/svg%3E'
            };
            
            log('âœ… å·²è¨­ç½®æ¸¬è©¦è³‡æ–™: ' + JSON.stringify(window.currentFoundItem, null, 2));
            
            try {
                // å‘¼å«é¡¯ç¤ºå½ˆçª—å‡½æ•¸
                if (typeof window.showOwnerInputModal === 'function') {
                    log('âœ… showOwnerInputModal å‡½æ•¸å­˜åœ¨');
                    
                    // æ¨¡æ“¬å½ˆçª—é¡¯ç¤º
                    const modal = document.getElementById('ownerInputModal');
                    if (modal) {
                        modal.classList.add('active');
                        log('âœ… å½ˆçª—é¡¯ç¤ºæˆåŠŸ');
                        
                        // å¡«å……é è¦½å€åŸŸ
                        const preview = document.getElementById('foundItemPreview');
                        if (preview) {
                            preview.innerHTML = `
                                <img src="${window.currentFoundItem.image_url}" alt="${window.currentFoundItem.name}">
                                <h4>${window.currentFoundItem.name}</h4>
                                <p>ğŸ“ ç™¼ç¾åœ°é»ï¼š${window.currentFoundItem.found_location}</p>
                            `;
                            log('âœ… ç‰©å“é è¦½å¡«å……å®Œæˆ');
                        }
                    } else {
                        log('âŒ æ‰¾ä¸åˆ° ownerInputModal å…ƒç´ ');
                    }
                } else {
                    log('âŒ showOwnerInputModal å‡½æ•¸ä¸å­˜åœ¨');
                }
            } catch (error) {
                log('âŒ æ­¥é©Ÿ1éŒ¯èª¤: ' + error.message);
            }
        }

        // æ­¥é©Ÿ2: æ¸¬è©¦ç¢ºèªå§“å
        function step2_TestConfirmName() {
            log('ğŸš€ æ­¥é©Ÿ2: æ¸¬è©¦ç¢ºèªå§“å');
            
            // è¨­ç½®æ¸¬è©¦å§“å
            const nameInput = document.getElementById('ownerNameInput');
            if (nameInput) {
                nameInput.value = 'æ¸¬è©¦ä¸»äºº';
                log('âœ… å·²è¨­ç½®æ¸¬è©¦å§“å: æ¸¬è©¦ä¸»äºº');
                
                try {
                    if (typeof window.confirmOwnerName === 'function') {
                        log('âœ… confirmOwnerName å‡½æ•¸å­˜åœ¨ï¼Œé–‹å§‹èª¿ç”¨...');
                        window.confirmOwnerName();
                        log('âœ… confirmOwnerName å‡½æ•¸èª¿ç”¨å®Œæˆ');
                    } else {
                        log('âŒ confirmOwnerName å‡½æ•¸ä¸å­˜åœ¨');
                    }
                } catch (error) {
                    log('âŒ æ­¥é©Ÿ2éŒ¯èª¤: ' + error.message);
                    log('âŒ éŒ¯èª¤å †ç–Š: ' + error.stack);
                }
            } else {
                log('âŒ æ‰¾ä¸åˆ° ownerNameInput å…ƒç´ ');
            }
        }

        // æ­¥é©Ÿ3: æ¸¬è©¦é¡¯ç¤ºç¢ºèª
        function step3_TestShowConfirm() {
            log('ğŸš€ æ­¥é©Ÿ3: æ¸¬è©¦é¡¯ç¤ºç¢ºèªå½ˆçª—');
            
            // ç¢ºä¿è®Šæ•¸å­˜åœ¨
            window.currentOwnerName = 'æ¸¬è©¦ä¸»äºº';
            
            try {
                if (typeof window.showOwnerConfirmModal === 'function') {
                    log('âœ… showOwnerConfirmModal å‡½æ•¸å­˜åœ¨ï¼Œé–‹å§‹èª¿ç”¨...');
                    window.showOwnerConfirmModal();
                    log('âœ… showOwnerConfirmModal å‡½æ•¸èª¿ç”¨å®Œæˆ');
                } else {
                    log('âŒ showOwnerConfirmModal å‡½æ•¸ä¸å­˜åœ¨');
                }
            } catch (error) {
                log('âŒ æ­¥é©Ÿ3éŒ¯èª¤: ' + error.message);
                log('âŒ éŒ¯èª¤å †ç–Š: ' + error.stack);
            }
        }

        // æ¸¬è©¦æœ€çµ‚ç¢ºèª
        function testFinalConfirm() {
            log('ğŸ‰ æ¸¬è©¦æœ€çµ‚ç¢ºèªåŠŸèƒ½');
            alert('æ¸¬è©¦æˆåŠŸï¼æ‰€æœ‰æ­¥é©Ÿéƒ½æ­£å¸¸é‹ä½œã€‚');
            
            // æ¸…ç†
            window.currentFoundItem = null;
            window.currentOwnerName = '';
            
            const modals = ['ownerInputModal', 'ownerConfirmModal'];
            modals.forEach(id => {
                const modal = document.getElementById(id);
                if (modal) {
                    modal.classList.remove('active');
                }
            });
            
            log('âœ… æ¸¬è©¦å®Œæˆï¼Œå·²æ¸…ç†ç’°å¢ƒ');
        }

        // ç›£è½éŒ¯èª¤
        window.addEventListener('error', function(e) {
            log('âŒ å…¨å±€éŒ¯èª¤: ' + e.message + ' (' + e.filename + ':' + e.lineno + ')');
        });

        // é é¢è¼‰å…¥å®Œæˆ
        window.addEventListener('load', function() {
            log('âœ… æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆ');
            log('ğŸ“Š å¯ç”¨çš„å‡½æ•¸:');
            log('  - showOwnerInputModal: ' + (typeof window.showOwnerInputModal));
            log('  - confirmOwnerName: ' + (typeof window.confirmOwnerName));
            log('  - showOwnerConfirmModal: ' + (typeof window.showOwnerConfirmModal));
        });
    </script>
</body>
</html>
