<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¾© Firebase Storage æ¬Šé™</title>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: #333;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #ff6b6b;
            margin: 0;
        }
        .step {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #ff6b6b;
        }
        .step h3 {
            margin-top: 0;
            color: #ff6b6b;
        }
        .code-block {
            background: #f1f3f4;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .copy-btn:hover {
            background: #ff5252;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }
        .btn.success {
            background: #28a745;
        }
        .btn.success:hover {
            background: #218838;
        }
        .log {
            background: #f1f3f4;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ä¿®å¾© Firebase Storage æ¬Šé™</h1>
            <p>è§£æ±º Storage æ¬Šé™ä¸è¶³å•é¡Œ</p>
        </div>

        <div class="step">
            <h3>ğŸ“‹ ç•¶å‰ç‹€æ…‹</h3>
            <div class="success">
                <p>âœ… <strong>Firestore é€£æ¥æ­£å¸¸</strong> - è³‡æ–™åº«åŠŸèƒ½å¯ç”¨</p>
            </div>
            <div class="error">
                <p>âŒ <strong>Storage æ¬Šé™ä¸è¶³</strong> - éœ€è¦è¨­å®šå®‰å…¨è¦å‰‡</p>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ› ï¸ ä¿®å¾©æ­¥é©Ÿ</h3>
            <div class="warning">
                <p><strong>é‡è¦ï¼š</strong>è«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿæ“ä½œï¼Œæ¯å€‹æ­¥é©Ÿéƒ½å¾ˆé‡è¦ï¼</p>
            </div>
            
            <h4>æ­¥é©Ÿ 1ï¼šå‰å¾€ Firebase æ§åˆ¶å°</h4>
            <p>
                <a href="https://console.firebase.google.com/project/story-wall-7af82/storage" target="_blank" class="btn">
                    ğŸ”— ç›´æ¥å‰å¾€ Storage è¨­å®š
                </a>
            </p>
            
            <h4>æ­¥é©Ÿ 2ï¼šè¨­å®š Storage è¦å‰‡</h4>
            <p>åœ¨ Firebase æ§åˆ¶å°ä¸­ï¼š</p>
            <ol>
                <li>é»æ“Š <strong>ã€Œè¦å‰‡ã€</strong> æ¨™ç±¤</li>
                <li>å°‡ä¸‹æ–¹è¦å‰‡è¤‡è£½ä¸¦è²¼ä¸Šï¼Œæ›¿æ›æ‰€æœ‰ç¾æœ‰å…§å®¹</li>
                <li>é»æ“Š <strong>ã€Œç™¼å¸ƒã€</strong> æŒ‰éˆ•</li>
            </ol>
            
            <div class="code-block">
                <button class="copy-btn" onclick="copyStorageRules()">è¤‡è£½</button>
                <pre id="storageRules">rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // å…è¨±è®€å–å’Œä¸Šå‚³å¤±ç‰©åœ–ç‰‡
    match /lost-items-images/{allPaths=**} {
      allow read, write: if true;
    }
    
    // æ¸¬è©¦ç”¨è³‡æ–™å¤¾
    match /test/{allPaths=**} {
      allow read, write: if true;
    }
    
    // æš«æ™‚å…è¨±æ‰€æœ‰å­˜å–ï¼ˆæ¸¬è©¦ç”¨ï¼‰
    match /{allPaths=**} {
      allow read, write: if true;
    }
  }
}</pre>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ§ª æ¸¬è©¦ä¿®å¾©çµæœ</h3>
            <button class="btn" onclick="testStorageAccess()">æ¸¬è©¦ Storage æ¬Šé™</button>
            <button class="btn success" onclick="testCompleteSetup()">å®Œæ•´åŠŸèƒ½æ¸¬è©¦</button>
            
            <div class="log" id="testLog">ç­‰å¾…æ¸¬è©¦...</div>
        </div>

        <div class="step">
            <h3>âœ… ä¿®å¾©å®Œæˆå¾Œ</h3>
            <div class="success">
                <p>ç•¶ Storage æ¬Šé™ä¿®å¾©å¾Œï¼Œæ‚¨å°±å¯ä»¥ï¼š</p>
                <ul>
                    <li>âœ… ä¸Šå‚³å¤±ç‰©ç…§ç‰‡</li>
                    <li>âœ… æŸ¥çœ‹å¤±ç‰©åœ–ç‰‡</li>
                    <li>âœ… ä½¿ç”¨å®Œæ•´çš„å¤±ç‰©æ•…äº‹ç‰†åŠŸèƒ½</li>
                </ul>
            </div>
            
            <a href="firebase-simple-test.html" class="btn success">ğŸ‰ å›åˆ°æ¸¬è©¦é é¢</a>
            <a href="firebase-test.html" class="btn success">ğŸš€ ä½¿ç”¨å®Œæ•´ç‰ˆæœ¬</a>
        </div>

        <div class="step">
            <h3>â“ å¸¸è¦‹å•é¡Œ</h3>
            <div class="warning">
                <p><strong>Q: ç‚ºä»€éº¼æœƒæœ‰æ¬Šé™å•é¡Œï¼Ÿ</strong></p>
                <p>A: Firebase Storage é è¨­æ‹’çµ•æ‰€æœ‰å­˜å–ï¼Œéœ€è¦æ‰‹å‹•è¨­å®šå®‰å…¨è¦å‰‡ã€‚</p>
                
                <p><strong>Q: é€™äº›è¦å‰‡å®‰å…¨å—ï¼Ÿ</strong></p>
                <p>A: ç›®å‰çš„è¦å‰‡å…è¨±æ‰€æœ‰äººå­˜å–ï¼Œé©åˆæ¸¬è©¦ä½¿ç”¨ã€‚æ­£å¼ç’°å¢ƒå»ºè­°åŠ å…¥é©—è­‰æ©Ÿåˆ¶ã€‚</p>
                
                <p><strong>Q: å¦‚æœé‚„æ˜¯ä¸è¡Œæ€éº¼è¾¦ï¼Ÿ</strong></p>
                <p>A: è«‹ç¢ºèª Firebase Storage å·²å•Ÿç”¨ï¼Œä¸¦ä¸”è¦å‰‡å·²æ­£ç¢ºç™¼å¸ƒã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyDm1Arp6DTUerSdTKjC4T4ndMRNDog4fuI",
            authDomain: "story-wall-7af82.firebaseapp.com",
            projectId: "story-wall-7af82",
            storageBucket: "story-wall-7af82.firebasestorage.app",
            messagingSenderId: "308812034466",
            appId: "1:308812034466:web:afa66ee199a49a5f49c2fb",
            measurementId: "G-QSEJ431VV0"
        };

        let firebaseApp, storage;

        function log(message) {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function copyStorageRules() {
            const rulesText = document.getElementById('storageRules').textContent;
            
            navigator.clipboard.writeText(rulesText).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = 'å·²è¤‡è£½ï¼';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#ff6b6b';
                }, 2000);
                
                log('âœ… Storage è¦å‰‡å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½');
            });
        }

        async function initializeFirebase() {
            try {
                if (!firebaseApp) {
                    firebaseApp = firebase.initializeApp(firebaseConfig);
                    storage = firebase.storage();
                    log('âœ… Firebase åˆå§‹åŒ–æˆåŠŸ');
                }
                return true;
            } catch (error) {
                log(`âŒ Firebase åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
                return false;
            }
        }

        async function testStorageAccess() {
            log('ğŸ§ª é–‹å§‹æ¸¬è©¦ Storage æ¬Šé™...');
            
            if (!await initializeFirebase()) {
                return;
            }

            try {
                // æ¸¬è©¦ 1: åˆ—å‡º buckets
                log('ğŸ“ æ¸¬è©¦ 1: æª¢æŸ¥ Storage å­˜å–æ¬Šé™...');
                const testRef = storage.ref('test/permission-test.txt');
                
                // æ¸¬è©¦ 2: ä¸Šå‚³æª”æ¡ˆ
                log('ğŸ“¤ æ¸¬è©¦ 2: å˜—è©¦ä¸Šå‚³æ¸¬è©¦æª”æ¡ˆ...');
                await testRef.putString('Storage æ¬Šé™æ¸¬è©¦æˆåŠŸï¼');
                log('âœ… æª”æ¡ˆä¸Šå‚³æˆåŠŸ');
                
                // æ¸¬è©¦ 3: ç²å–ä¸‹è¼‰ URL
                log('ğŸ”— æ¸¬è©¦ 3: ç²å–æª”æ¡ˆ URL...');
                const downloadURL = await testRef.getDownloadURL();
                log(`âœ… æª”æ¡ˆ URL ç²å–æˆåŠŸ: ${downloadURL.substring(0, 50)}...`);
                
                // æ¸¬è©¦ 4: åˆªé™¤æª”æ¡ˆ
                log('ğŸ—‘ï¸ æ¸¬è©¦ 4: æ¸…ç†æ¸¬è©¦æª”æ¡ˆ...');
                await testRef.delete();
                log('âœ… æ¸¬è©¦æª”æ¡ˆå·²æ¸…ç†');
                
                log('ğŸ‰ æ‰€æœ‰ Storage æ¸¬è©¦é€šéï¼æ¬Šé™è¨­å®šæ­£ç¢ºï¼');
                
            } catch (error) {
                log(`âŒ Storage æ¸¬è©¦å¤±æ•—: ${error.message}`);
                
                if (error.code === 'storage/unauthorized') {
                    log('ğŸ’¡ è§£æ±ºæ–¹æ¡ˆ: è«‹æŒ‰ç…§ä¸Šæ–¹æ­¥é©Ÿè¨­å®š Storage è¦å‰‡');
                } else if (error.code === 'storage/unknown') {
                    log('ğŸ’¡ å¯èƒ½åŸå› : Storage æœå‹™æœªå•Ÿç”¨ï¼Œè«‹åœ¨ Firebase æ§åˆ¶å°å•Ÿç”¨');
                }
            }
        }

        async function testCompleteSetup() {
            log('ğŸ” é–‹å§‹å®Œæ•´åŠŸèƒ½æ¸¬è©¦...');
            
            if (!await initializeFirebase()) {
                return;
            }

            try {
                // æ¸¬è©¦ Storage
                await testStorageAccess();
                
                log('ğŸ‰ å®Œæ•´æ¸¬è©¦é€šéï¼Firebase è¨­å®šæ­£ç¢ºï¼');
                log('ğŸ’¡ ç¾åœ¨å¯ä»¥ä½¿ç”¨å®Œæ•´çš„å¤±ç‰©æ•…äº‹ç‰†åŠŸèƒ½äº†ï¼');
                
            } catch (error) {
                log(`âŒ å®Œæ•´æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.addEventListener('load', () => {
            log('ğŸ”§ Storage æ¬Šé™ä¿®å¾©å·¥å…·å·²æº–å‚™å°±ç·’');
            log('ğŸ’¡ è«‹å…ˆæŒ‰ç…§æ­¥é©Ÿè¨­å®š Firebase Storage è¦å‰‡');
        });
    </script>
</body>
</html>

